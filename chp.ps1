$windows = (Get-WmiObject -class Win32_OperatingSystem).Caption
$windows = $windows -replace "[^a-zA-Z0-9 ]", ""
$windows = $windows.trim()

Write-Output $windows

$hotfix_out = Get-HotFix | Select-Object HotFixID
$hotfixes = @()
$installed_fix = $false

foreach ($e in $hotfix_out){
    $str = $e | Out-String
    $hotfixes += $str.trim().split()[-1]
}

$needed_fixes = @("KB500871")

Write-Output ""

foreach ($fix in $needed_fixes){
    if ($hotfixes -contains $fix){
        $installed_fix = $true
        Write-Output "Hotfix $fix found!"
    }
}

if ($installed_fix){
    Write-Output "Required hotfix installed"
    exit 0
}
else {
    Write-Output "Required hotfix not installed."
    Write-Output "Please install one of the following hotfixes: $needed_fixes"
    exit 2
}

Write-Output ""
pause